{
	"configuration":{},
	"connectionName":"MRS_Spark_Agent",
	"content":"-- SPARK sql \n-- ******************************************************************** --\n-- author: jh_zhaochenlong\n-- create time: 2025/05/26 14:07:50 GMT+08:00\n-- descr: 廉政八项-设备智维专线-机库旁消耗\n-- ******************************************************************** --\n-- CREATE TABLE\n-- \tdwi_eqp.dwi_eqp_lz_side_wh_cost_data (\n-- \t\tio_persion STRING COMMENT '交易人',\n-- \t\tio_dept STRING COMMENT '交易部门',\n-- \t\tio_time STRING COMMENT '交易时间',\n-- \t\tio_remark STRING COMMENT '出入库单备注',\n-- \t\torder_status STRING COMMENT '出入库单据状态',\n-- \t\tcreate_user_dept STRING COMMENT '出入库单创建人部门',\n-- \t\tcreate_user_factory STRING COMMENT '创建人生产厂',\n-- \t\torder_no STRING COMMENT '出入库单据号',\n-- \t\tapply_persion STRING COMMENT '申请人',\n-- \t\tapply_dept STRING COMMENT '申请单位',\n-- \t\tname STRING COMMENT '单据名称',\n-- \t\tio_type STRING COMMENT '交易类型',\n-- \t\tio_type_detail STRING COMMENT '出入库类型细项',\n-- \t\tmaterial_no STRING COMMENT '料号',\n-- \t\tbatch_no STRING COMMENT '批号',\n-- \t\tmaterial_name STRING COMMENT '物料名称',\n-- \t\tio_quantity DECIMAL(20, 3) COMMENT '交易数量',\n-- \t\tio_price DECIMAL(20, 3) COMMENT '交易单价',\n-- \t\tio_total_price DECIMAL(20, 3) COMMENT '交易总价',\n-- \t\tlocat_no STRING COMMENT '储位编号',\n-- \t\tlocat_name STRING COMMENT '储位名称',\n-- \t\tstorage_remark STRING COMMENT '储位备注',\n-- \t\tstorage_maint_dept STRING COMMENT '储位责任单位',\n-- \t\tstorage_manage_person STRING COMMENT '储位仓库管理员',\n-- \t\tside_no STRING COMMENT '库位编号',\n-- \t\tside_name STRING COMMENT '库位名称',\n-- \t\tfactory STRING COMMENT '库位所属厂',\n-- \t\tworkshop STRING COMMENT '库位所属车间',\n-- \t\tside_maint_dept STRING COMMENT '库位责任单位',\n-- \t\tside_manage_person STRING COMMENT '库位仓库管理员',\n-- \t\tside_remark STRING COMMENT '库位备注',\n-- \t\tmodel STRING COMMENT '物料型号规格',\n-- \t\ttechnical_req STRING COMMENT '物料技术要求',\n-- \t\tbrand STRING COMMENT '物料品牌',\n-- \t\tsupplier STRING COMMENT '建议厂商',\n-- \t\tunit STRING COMMENT '计量单位',\n-- \t\tmaterial_price DECIMAL(20, 3) COMMENT '前期单价',\n-- \t\tuse_life DECIMAL(10, 0) COMMENT '使用寿命',\n-- \t\tpurchase_cycle STRING COMMENT '采购周期',\n-- \t\tpic_no STRING COMMENT '图号',\n-- \t\ttexture STRING COMMENT '材质',\n-- \t\tsupply_scope STRING COMMENT '供货范围',\n-- \t\ttype_one STRING COMMENT '备件或材料',\n-- \t\tquantity DECIMAL(20, 0) COMMENT '库存数量',\n-- \t\tstock_type STRING COMMENT '库存类型',\n-- \t\tamount DECIMAL(20, 3) COMMENT '库存总价',\n-- \t\tinventory_name STRING COMMENT '盘库单据名称',\n-- \t\tside_id STRING COMMENT '盘库库位',\n-- \t\tinventory_person STRING COMMENT '盘点人',\n-- \t\tinventory_dept STRING COMMENT '盘点部门',\n-- \t\ttotal DECIMAL(20, 0) COMMENT '盘库总额',\n-- \t\tinventory_type STRING COMMENT '盘库库存类型',\n-- \t\tinventory_price STRING COMMENT '盘库单价',\n-- \t\ttotal_price STRING COMMENT '盘库总金额',\n-- \t\tbook_quantity DECIMAL(20, 0) COMMENT '盘库账面数',\n-- \t\tactual_quantity DECIMAL(20, 0) COMMENT '盘库实物数',\n-- \t\tsurplus DECIMAL(20, 0) COMMENT '盘盈',\n-- \t\tloss DECIMAL(20, 0) COMMENT '盘亏',\n-- \t\treason STRING COMMENT '盘库原因分析',\n-- \t\tinventory_id STRING COMMENT '盘库单据号',\n-- \t\tallot_no STRING COMMENT '调拨单据号',\n-- \t\tallot_quantity DECIMAL(20, 0) COMMENT '调拨交易量',\n-- \t\tstorage_old STRING COMMENT '调拨原储位',\n-- \t\tstorage_new STRING COMMENT '调拨新储位',\n-- \t\tallot_status STRING COMMENT '调拨状态',\n-- \t\tallot_time STRING COMMENT '调拨时间',\n-- \t\tside_old STRING COMMENT '调拨原库位',\n-- \t\tside_new STRING COMMENT '调拨新库位',\n-- \t\tio_dept_id STRING COMMENT '交易部门ID',\n-- \t\tio_dept_no STRING COMMENT '交易部门编码',\n-- \t\tcreate_user_dept_id STRING COMMENT '出入库单创建人部门ID',\n-- \t\tcreate_user_dept_no STRING COMMENT '出入库单创建人部门编码',\n-- \t\tcreate_user_factory_id STRING COMMENT '出入库单创建人生产厂ID',\n-- \t\tcreate_user_factory_no STRING COMMENT '出入库单创建人生产厂编码',\n-- \t\tapply_dept_id STRING COMMENT '申请单位ID',\n-- \t\tapply_dept_no STRING COMMENT '申请单位编码',\n-- \t\tstorage_maint_dept_id STRING COMMENT '储位责任单位ID',\n-- \t\tstorage_maint_dept_no STRING COMMENT '储位责任单位编码',\n-- \t\tfactory_id STRING COMMENT '库位所属厂ID',\n-- \t\tfactory_no STRING COMMENT '库位所属厂编码',\n-- \t\tworkshop_id STRING COMMENT '库位所属车间ID',\n-- \t\tworkshop_no STRING COMMENT '库位所属车间编码',\n-- \t\tside_maint_dept_id STRING COMMENT '库位责任单位ID',\n-- \t\tside_maint_dept_no STRING COMMENT '库位责任单位编码',\n-- \t\tside_id_id STRING COMMENT '盘库库位ID',\n-- \t\tside_io_id STRING COMMENT '出入库单据ID',\n-- \t\tside_id_1 STRING COMMENT '库位ID',\n-- \t\tside_storage_id STRING COMMENT '储位ID',\n-- \t\tmaterial_id STRING COMMENT '物料ID',\n-- \t\tside_stock_id STRING COMMENT '库存ID',\n-- \t\tinventory_id_id STRING COMMENT '盘库单ID',\n-- \t\tinventory_dept_id STRING COMMENT '盘点部门ID',\n-- \t\tinventory_dept_no STRING COMMENT '盘点部门编码',\n-- \t\tallot_id STRING COMMENT '调拨单ID',\n-- \t\tstorage_old_id STRING COMMENT '调拨原储位ID',\n-- \t\tstorage_new_id STRING COMMENT '调拨新储位ID',\n-- \t\tside_old_id STRING COMMENT '调拨原库位ID',\n-- \t\tside_new_id STRING COMMENT '调拨新库位ID'\n-- \t) COMMENT '廉政八项-设备智维专线-机库旁消耗' STORED AS orc TBLPROPERTIES (\"orc.compress\" = \"SNAPPY\");\nINSERT OVERWRITE TABLE\n\tdwi_eqp.dwi_eqp_lz_side_wh_cost_data (\n\t\tio_persion,\n\t\tio_dept,\n\t\tio_time,\n\t\tio_remark,\n\t\torder_status,\n\t\tcreate_user_dept,\n\t\tcreate_user_factory,\n\t\torder_no,\n\t\tapply_persion,\n\t\tapply_dept,\n\t\tname,\n\t\tio_type,\n\t\tio_type_detail,\n\t\tmaterial_no,\n\t\tbatch_no,\n\t\tmaterial_name,\n\t\tio_quantity,\n\t\tio_price,\n\t\tio_total_price,\n\t\tlocat_no,\n\t\tlocat_name,\n\t\tstorage_remark,\n\t\tstorage_maint_dept,\n\t\tstorage_manage_person,\n\t\tside_no,\n\t\tside_name,\n\t\tfactory,\n\t\tworkshop,\n\t\tside_maint_dept,\n\t\tside_manage_person,\n\t\tside_remark,\n\t\tmodel,\n\t\ttechnical_req,\n\t\tbrand,\n\t\tsupplier,\n\t\tunit,\n\t\tmaterial_price,\n\t\tuse_life,\n\t\tpurchase_cycle,\n\t\tpic_no,\n\t\ttexture,\n\t\tsupply_scope,\n\t\ttype_one,\n\t\tquantity,\n\t\tstock_type,\n\t\tamount,\n\t\tinventory_name,\n\t\tside_id,\n\t\tinventory_person,\n\t\tinventory_dept,\n\t\ttotal,\n\t\tinventory_type,\n\t\tinventory_price,\n\t\ttotal_price,\n\t\tbook_quantity,\n\t\tactual_quantity,\n\t\tsurplus,\n\t\tloss,\n\t\treason,\n\t\tinventory_id,\n\t\tallot_no,\n\t\tallot_quantity,\n\t\tstorage_old,\n\t\tstorage_new,\n\t\tallot_status,\n\t\tallot_time,\n\t\tside_old,\n\t\tside_new,\n\t\tio_dept_id,\n\t\tio_dept_no,\n\t\tcreate_user_dept_id,\n\t\tcreate_user_dept_no,\n\t\tcreate_user_factory_id,\n\t\tcreate_user_factory_no,\n\t\tapply_dept_id,\n\t\tapply_dept_no,\n\t\tstorage_maint_dept_id,\n\t\tstorage_maint_dept_no,\n\t\tfactory_id,\n\t\tfactory_no,\n\t\tworkshop_id,\n\t\tworkshop_no,\n\t\tside_maint_dept_id,\n\t\tside_maint_dept_no,\n\t\tside_id_id,\n\t\tside_io_id,\n\t\tside_id_1,\n\t\tside_storage_id,\n\t\tmaterial_id,\n\t\tside_stock_id,\n\t\tinventory_id_id,\n\t\tinventory_dept_id,\n\t\tinventory_dept_no,\n\t\tallot_id,\n\t\tstorage_old_id,\n\t\tstorage_new_id,\n\t\tside_old_id,\n\t\tside_new_id\n\t)\nSELECT\n\tmh_side_io.io_persion AS io_persion, -- 交易人\n\tmh_side_io.io_dept AS io_dept, -- 交易部门\n\tmh_side_io.io_time AS io_time, -- 交易时间\n\tmh_side_io.remark AS io_remark, -- 出入库单备注\n\tmh_side_io.order_status AS order_status, -- 出入库单据状态\n\thr_department1.str_name AS create_user_dept, -- 出入库单创建人部门\n\tsupport_factory_info.factory_name AS create_user_factory, -- 创建人生产厂\n\tmh_side_io.order_no AS order_no, -- 出入库单据号\n\tmh_side_io.apply_persion AS apply_persion, -- 申请人\n\tmh_side_io.apply_dept AS apply_dept, -- 申请单位\n\tmh_side_io.name AS name, -- 单据名称\n\tmh_side_io.io_type AS io_type, -- 交易类型\n\tmh_side_io.io_type_detail AS io_type_detail, -- 出入库类型细项\n\tmh_side_io_detail.material_no AS material_no, -- 料号\n\tmh_side_io_detail.batch_no AS batch_no, -- 批号\n\tmh_side_io_detail.material_name AS material_name, -- 物料名称\n\tmh_side_io_detail.io_quantity AS io_quantity, -- 交易数量\n\tmh_side_io_detail.io_price AS io_price, -- 交易单价\n\tmh_side_io_detail.io_total_price AS io_total_price, -- 交易总价\n\tmh_side_storage.locat_no AS locat_no, -- 储位编号\n\tmh_side_storage.locat_name AS locat_name, -- 储位名称\n\tmh_side_storage.remark AS storage_remark, -- 储位备注\n\tmh_side_storage.maint_dept AS storage_maint_dept, -- 储位责任单位\n\thr_user.name AS storage_manage_person, -- 储位仓库管理员\n\tmh_side.side_no AS side_no, -- 库位编号\n\tmh_side.side_name AS side_name, -- 库位名称\n\thr_department3.str_name AS factory, -- 库位所属厂\n\tmh_side.workshop AS workshop, -- 库位所属车间\n\thr_department4.str_name AS side_maint_dept, -- 库位责任单位\n\tmh_side.manage_person AS side_manage_person, -- 库位仓库管理员\n\tmh_side.remark AS side_remark, -- 库位备注\n\tmh_material.model AS model, -- 物料型号规格\n\tmh_material.technical_req AS technical_req, -- 物料技术要求\n\tmh_material.brand AS brand, -- 物料品牌\n\tmh_material.supplier AS supplier, -- 建议厂商\n\tmh_material.unit AS unit, -- 计量单位\n\tmh_material.price AS material_price, -- 前期单价\n\tmh_material.use_life AS use_life, -- 使用寿命\n\tmh_material.purchase_cycle AS purchase_cycle, -- 采购周期\n\tmh_material.pic_no AS pic_no, -- 图号\n\tmh_material.texture AS texture, -- 材质\n\tmh_material.supply_scope AS supply_scope, -- 供货范围\n\tmh_material.type_one AS type_one, -- 备件、材料\n\tmh_side_stock.quantity AS quantity, -- 库存数量\n\tmh_side_stock.stock_type AS stock_type, -- 库存类型\n\tmh_side_stock.amount AS amount, -- 库存总价\n\tmh_inventory.inventory_name AS inventory_name, -- 盘库单据名称\n\tmh_inventory.side_id AS side_id, -- 盘库库位\n\tmh_inventory.inventory_person AS inventory_person, -- 盘点人\n\tmh_inventory.inventory_dept AS inventory_dept, -- 盘点部门\n\tmh_inventory.total AS total, -- 盘库总额\n\tmh_inventory_detail.stock_type AS inventory_type, -- 盘库库存类型\n\tmh_inventory_detail.price AS inventory_price, -- 盘库单价\n\tmh_inventory_detail.total_price AS total_price, -- 盘库总金额\n\tmh_inventory_detail.book_quantity AS book_quantity, -- 盘库账面数\n\tmh_inventory_detail.actual_quantity AS actual_quantity, -- 盘库实物数\n\tmh_inventory_detail.surplus AS surplus, -- 盘盈\n\tmh_inventory_detail.loss AS loss, -- 盘亏\n\tmh_inventory_detail.reason AS reason, -- 盘库原因分析\n\tmh_inventory_detail.inventory_id AS inventory_id, -- 盘库单据号\n\tmh_allot.allot_no AS allot_no, -- 调拨单据号\n\tmh_allot_detail.allot_quantity AS allot_quantity, -- 调拨交易量\n\tmh_side_storage1.locat_name AS storage_old, -- 调拨原储位\n\tmh_side_storage2.locat_name AS storage_new, -- 调拨新储位\n\tmh_allot_detail.allot_status AS allot_status, -- 调拨状态\n\tmh_allot_detail.allot_time AS allot_time, -- 调拨时间\n\tmh_side1.side_name AS side_old, -- 调拨原库位\n\tmh_side2.side_name AS side_new, -- 调拨新库位 \n\tmh_side_io.io_dept AS io_dept_id, -- 交易部门ID\n\tmh_side_io.io_dept AS io_dept_no, -- 交易部门编码\n\thr_department1.id AS create_user_dept_id, -- 出入库单创建人部门ID\n\tmh_side_io.create_user_dept AS create_user_dept_no, -- 出入库单创建人部门编码\n\thr_department5.id AS create_user_factory_id, -- 出入库单创建人生产厂ID\n\tmh_side_io.create_user_factory AS create_user_factory_no, -- 出入库单创建人生产厂编码\n\thr_department2.id AS apply_dept_id, -- 申请单位ID\n\thr_department2.str_sn AS apply_dept_no, -- 申请单位编码\n\tmh_side_storage.maint_dept AS storage_maint_dept_id, -- 储位责任单位ID\n\tmh_side_storage.maint_dept AS storage_maint_dept_no, -- 储位责任单位编码\n\tmh_side.factory AS factory_id, -- 库位所属厂ID\n\thr_department3.str_sn AS factory_no, -- 库位所属厂编码\n\tmh_side.workshop AS workshop_id, -- 库位所属车间ID\n\tmh_side.workshop AS workshop_no, -- 库位所属车间编码\n\thr_department4.id AS side_maint_dept_id, -- 库位责任单位ID\n\tmh_side.maint_dept AS side_maint_dept_no, -- 库位责任单位编码\n\tmh_inventory.side_id AS side_id_id, -- 盘库库位ID\n\tmh_side_io.id AS side_io_id, -- 出入库单据ID\n\tmh_side.id AS side_id_1, -- 库位ID\n\tmh_side_storage.id AS side_storage_id, -- 储位ID\n\tmh_material.id AS material_id, -- 物料ID\n\tmh_side_stock.id AS side_stock_id, -- 库存ID\n\tmh_inventory.id AS inventory_id_id, -- 盘库单ID\n\tmh_inventory.inventory_dept AS inventory_dept_id, -- 盘点部门ID\n\tmh_inventory.inventory_dept AS inventory_dept_no, -- 盘点部门编码\n\tmh_allot.id AS allot_id, -- 调拨单ID\n\tmh_allot_detail.storage_old AS storage_old_id, -- 调拨原储位ID\n\tmh_allot_detail.storage_new AS storage_new_id, -- 调拨新储位ID\n\tmh_allot_detail.side_old AS side_old_id, -- 调拨原库位ID\n\tmh_allot_detail.side_new AS side_new_id -- 调拨新库位ID\nFROM\n\t(\n\t\tSELECT\n\t\t\t*\n\t\tFROM\n\t\t\tdwi_eqp.dwi_eqp_mh_side_io_in\n\t\tUNION ALL\n\t\tSELECT\n\t\t\t*\n\t\tFROM\n\t\t\tdwi_eqp.dwi_eqp_mh_side_io_out\n\t) mh_side_io\n\tJOIN (\n\t\tSELECT\n\t\t\t*\n\t\tFROM\n\t\t\tdwi_eqp.dwi_eqp_mh_side_io_detail_in\n\t\tUNION ALL\n\t\tSELECT\n\t\t\t*\n\t\tFROM\n\t\t\tdwi_eqp.dwi_eqp_mh_side_io_detail_out\n\t) mh_side_io_detail ON mh_side_io.id = mh_side_io_detail.io_order_id\n\tJOIN dwi_eqp.dwi_eqp_mh_material mh_material ON mh_material.material_no = mh_side_io_detail.material_no\n\tJOIN dwi_eqp.dwi_eqp_mh_side_stock mh_side_stock ON mh_material.material_no = mh_side_stock.material_no\n\tJOIN dwi_eqp.dwi_eqp_mh_side_storage mh_side_storage ON mh_side_stock.storage_id = mh_side_storage.id\n\tJOIN dwi_eqp.dwi_eqp_mh_side mh_side ON mh_side.id = mh_side_storage.side_id\n\tLEFT JOIN dwi_eqp.dwi_eqp_mh_inventory_detail mh_inventory_detail ON mh_material.material_no = mh_inventory_detail.material_no\n\tJOIN dwi_eqp.dwi_eqp_mh_allot_detail mh_allot_detail ON mh_material.material_no = mh_allot_detail.material_no\n\tJOIN dwi_eqp.dwi_eqp_mh_allot mh_allot ON mh_allot.id = mh_allot_detail.allot_id\n\tLEFT JOIN dwi_eqp.dwi_eqp_mh_inventory mh_inventory ON mh_inventory.id = mh_inventory_detail.inventory_id\n\tLEFT JOIN dwi_eqp.dwi_eqp_support_factory_info support_factory_info ON mh_side_io.create_user_factory = support_factory_info.factory_no\n\tLEFT JOIN dwi_eqp.dwi_eqp_mh_side mh_side1 ON mh_allot_detail.side_old = mh_side1.id\n\tLEFT JOIN dwi_eqp.dwi_eqp_mh_side mh_side2 ON mh_allot_detail.side_new = mh_side2.id\n\tLEFT JOIN dwi_eqp.dwi_eqp_mh_side_storage mh_side_storage1 ON mh_allot_detail.storage_old = mh_side_storage1.id\n\tLEFT JOIN dwi_eqp.dwi_eqp_mh_side_storage mh_side_storage2 ON mh_allot_detail.storage_new = mh_side_storage2.id\n\tLEFT JOIN dwi_eqp.dwi_eqp_hr_user hr_user ON mh_side_storage.manage_person = hr_user.user_no\n\tLEFT JOIN dwi_eqp.dwi_eqp_hr_department hr_department1 ON mh_side_io.create_user_dept = hr_department1.str_sn\n\tLEFT JOIN dwi_eqp.dwi_eqp_hr_department hr_department2 ON mh_side_io.apply_dept = hr_department2.str_name\n\tLEFT JOIN dwi_eqp.dwi_eqp_hr_department hr_department3 ON mh_side.factory = hr_department3.id\n\tLEFT JOIN dwi_eqp.dwi_eqp_hr_department hr_department4 ON mh_side.maint_dept = hr_department4.str_sn\n\tLEFT JOIN dwi_eqp.dwi_eqp_hr_department hr_department5 ON mh_side_io.create_user_factory = hr_department5.str_sn;",
	"currentDatabase":"dwi_prd",
	"description":"",
	"directory":"/廉政专项/设备智维/HIVE",
	"name":"etl_dwi_eqp_lz_side_wh_cost_data",
	"owner":"jh_zhaochenlong",
	"templateVersion":"1.0",
	"type":"SparkSQL"
}