{
	"configuration":{},
	"connectionName":"MRS_Spark_Agent",
	"content":"-- SPARK sql \n-- ******************************************************************** --\n-- author: jh_zhaochenlong\n-- create time: 2025/05/26 13:28:49 GMT+08:00\n-- descr: 廉政八项-设备智维专线-设备检修履历\n-- ******************************************************************** --\n-- CREATE TABLE\n-- \tdwi_eqp.dwi_eqp_lz_eqp_maintenance_data (\n-- \t\trep_plan_no STRING COMMENT '检修计划编号',\n-- \t\tpre_plan_id STRING COMMENT '检修预排计划id',\n-- \t\tplan_name STRING COMMENT '计划名称',\n-- \t\tplan_desc STRING COMMENT '计划说明',\n-- \t\tplan_type STRING COMMENT '计划类型',\n-- \t\tfactory_id STRING COMMENT '生产厂',\n-- \t\tplan_beg_time STRING COMMENT '预计开始时间',\n-- \t\tplan_end_time STRING COMMENT '预计结束时间',\n-- \t\treal_beg_time STRING COMMENT '实际开始时间',\n-- \t\treal_end_time STRING COMMENT '实际结束时间',\n-- \t\tplan_stus STRING COMMENT '计划状态',\n-- \t\tapprove_status STRING COMMENT '审批状态',\n-- \t\tcompany_id STRING COMMENT '公司别',\n-- \t\tplan_status DECIMAL(1, 0) COMMENT '检修计划状态',\n-- \t\tline_end_time STRING COMMENT '产线停机时间',\n-- \t\tline_start_time STRING COMMENT '产线开机时间',\n-- \t\tline_id STRING COMMENT '产线',\n-- \t\tsummary_user STRING COMMENT '总结人',\n-- \t\tsummary_time STRING COMMENT '总结时间',\n-- \t\tsummary_content STRING COMMENT '总结内容',\n-- \t\toverall_leader STRING COMMENT '检修整体负责人',\n-- \t\tflow_id STRING COMMENT '审批流id',\n-- \t\tapprove_time STRING COMMENT '审批时间(计划审批后或计划变更审批后)',\n-- \t\tapprover_list STRING COMMENT '审批群组',\n-- \t\tspare_cost DECIMAL(20, 4) COMMENT '备件总费用(新增)',\n-- \t\tmaterial_cost DECIMAL(20, 4) COMMENT '材料总费用(新增)',\n-- \t\tpro_cost DECIMAL(20, 4) COMMENT '施工总费用(新增)',\n-- \t\tother_cost DECIMAL(20, 4) COMMENT '其他总费用(新增)',\n-- \t\tcontract_cost DECIMAL(20, 4) COMMENT '外委合同价(新增)',\n-- \t\tlabor_cost DECIMAL(20, 4) COMMENT '外委人工费(新增)',\n-- \t\ttask_no STRING COMMENT '工单编号',\n-- \t\teq_no STRING COMMENT '设备编码',\n-- \t\tresp_user_id STRING COMMENT '负责人员(检修单位)',\n-- \t\tresp_dept_id STRING COMMENT '负责单位(检修单位)',\n-- \t\twork_date STRING COMMENT '工作日期',\n-- \t\tjob_cont STRING COMMENT '工作内容',\n-- \t\ttask_type STRING COMMENT '工单类型',\n-- \t\tmajor_danger STRING COMMENT '主要危险',\n-- \t\tsafe_mesu STRING COMMENT '安全措施',\n-- \t\ttask_beg_time STRING COMMENT '实际开始时间',\n-- \t\ttask_end_time STRING COMMENT '实际结束时间',\n-- \t\tfinish_user_id STRING COMMENT '完工人员',\n-- \t\tfinish_time STRING COMMENT '完工时间',\n-- \t\tchk_user_id STRING COMMENT '验收人员',\n-- \t\tchk_desc STRING COMMENT '验收意见',\n-- \t\tchk_time STRING COMMENT '验收时间',\n-- \t\tis_pass STRING COMMENT '是否合格',\n-- \t\tsop_id STRING COMMENT 'SOP',\n-- \t\ttask_stus STRING COMMENT '工单状态',\n-- \t\tback_reason STRING COMMENT '退回原因',\n-- \t\tplan_remark STRING COMMENT '检修计划备注',\n-- \t\ttask_status DECIMAL(1, 0) COMMENT '检修任务状态',\n-- \t\trep_plan_id STRING COMMENT '检修计划id',\n-- \t\tis_over_time_unfinish STRING COMMENT '是否逾期未处理',\n-- \t\tfault STRING COMMENT '故障现象',\n-- \t\tapply_date STRING COMMENT '报修日期',\n-- \t\tfinish_desc STRING COMMENT '完工意见',\n-- \t\tis_finish STRING COMMENT '是否完工',\n-- \t\tis_accept STRING COMMENT '是否接办',\n-- \t\tsop_ids STRING COMMENT '关联sop的ID字符串集(以分号分割)',\n-- \t\treason STRING COMMENT '逾期未处理原因',\n-- \t\ttask_pre_beg_time STRING COMMENT '预计开始时间',\n-- \t\ttask_pre_end_time STRING COMMENT '预计结束时间',\n-- \t\tmajor_user_id STRING COMMENT '专业或技术人员',\n-- \t\tsafe_user_id STRING COMMENT '安全或监护人员',\n-- \t\torder_id STRING COMMENT '出库id',\n-- \t\tdatum_ids STRING COMMENT '维修基准id',\n-- \t\teq_nos STRING COMMENT '设备编号',\n-- \t\tobject_id STRING COMMENT '实物编码',\n-- \t\tmajor_danger_name STRING COMMENT '主要危险名称(换行并加序号)',\n-- \t\tsafe_mesu_name STRING COMMENT '安全措施(换行并加序号)',\n-- \t\twork_shop_id STRING COMMENT '车间id',\n-- \t\tlock_node STRING COMMENT '上锁点',\n-- \t\tmaint_user_id STRING COMMENT '检修单位负责人',\n-- \t\tmaint_dept_id STRING COMMENT '检修单位',\n-- \t\ttime_length STRING COMMENT '检修时长',\n-- \t\ttime_length_pre STRING COMMENT '预计检修时长',\n-- \t\tis_schedule STRING COMMENT '是否属于排程',\n-- \t\teq_major STRING COMMENT '专业',\n-- \t\tapply_user_id STRING COMMENT '报修人员',\n-- \t\tapply_dept_id STRING COMMENT '报修单位',\n-- \t\tchk_user_id_business STRING COMMENT '验收人员(事业部)',\n-- \t\tchk_desc_business STRING COMMENT '验收意见(事业部)',\n-- \t\tchk_time_business STRING COMMENT '验收时间(事业部)',\n-- \t\tchk_user_id_company STRING COMMENT '验收人员(制造部)',\n-- \t\tchk_desc_company STRING COMMENT '验收意见(制造部)',\n-- \t\tchk_time_company STRING COMMENT '验收时间(制造部)',\n-- \t\tchk_stus STRING COMMENT '验收状态(1第一步验收_2第二步验收_3第三步验收)',\n-- \t\tchk_level STRING COMMENT '验收级别(1一级验收_2二级验收_3三级验收)',\n-- \t\tmaint_dept_out STRING COMMENT '协力单位',\n-- \t\tchk_user_id_back STRING COMMENT '验收人员(修改前)',\n-- \t\tchk_user_id_business_back STRING COMMENT '验收人员(事业部)(修改前)',\n-- \t\tchk_user_id_company_back STRING COMMENT '验收人员(制造部)(修改前)',\n-- \t\tis_consume STRING COMMENT '是否备件消耗',\n-- \t\tis_important STRING COMMENT '是否重点项目',\n-- \t\tdanger_level STRING COMMENT '危险作业等级',\n-- \t\tchk_back_reason STRING COMMENT '验收退回原因(新增字段)',\n-- \t\tconfirm_user_no STRING COMMENT '确认人员',\n-- \t\tconfirm_time STRING COMMENT '确认时间',\n-- \t\treal_user_num STRING COMMENT '实际完工人数',\n-- \t\ttask_id STRING COMMENT '工单id',\n-- \t\tobject_no STRING COMMENT '实物编码',\n-- \t\tmtrl_id STRING COMMENT '物料id',\n-- \t\tmtrl_qty DECIMAL(8, 2) COMMENT '消耗的数量',\n-- \t\tprice DECIMAL(20, 2) COMMENT '单价',\n-- \t\ttotal_price DECIMAL(20, 2) COMMENT '总价',\n-- \t\tstorage STRING COMMENT '出库储位',\n-- \t\tbatch_no STRING COMMENT '批号',\n-- \t\tsupplier STRING COMMENT '供应商',\n-- \t\tis_change STRING COMMENT '是否备件更换',\n-- \t\tchange_qty DECIMAL(8, 2) COMMENT '备件更换数量',\n-- \t\trepair_qty DECIMAL(8, 2) COMMENT '备件修理数量',\n-- \t\trv_qty DECIMAL(8, 2) COMMENT '备件报废数量',\n-- \t\tkeep_qty DECIMAL(8, 2) COMMENT '备件保养数量',\n-- \t\tonline_date STRING COMMENT '备件上线日期',\n-- \t\toff_place STRING COMMENT '备件下线位置',\n-- \t\ttask_remark STRING COMMENT '检修任务备注',\n-- \t\tmaterial_status DECIMAL(1, 0) COMMENT '检修物料状态',\n-- \t\tsop_mtrl_id STRING COMMENT '检修作业备件id',\n-- \t\tout_store_type STRING COMMENT '出库方式',\n-- \t\ton_place STRING COMMENT '备件上线位置',\n-- \t\toffline_date STRING COMMENT '备件下线日期',\n-- \t\tconsume_remark STRING COMMENT '消耗异常备注'\n-- \t) COMMENT '廉政八项-设备智维专线-设备检修履历' STORED AS orc TBLPROPERTIES (\"orc.compress\" = \"SNAPPY\");\nINSERT OVERWRITE TABLE\n\tdwi_eqp.dwi_eqp_lz_eqp_maintenance_data\nSELECT\n\tt1.rep_plan_no, -- 检修计划编号\n\tt1.pre_plan_id, -- 检修预排计划id\n\tt1.plan_name, -- 计划名称\n\tt1.plan_desc, -- 计划说明\n\tt1.plan_type, -- 计划类型\n\tt1.factory_id, -- 生产厂\n\tt1.plan_beg_time, -- 预计开始时间\n\tt1.plan_end_time, -- 预计结束时间\n\tt1.real_beg_time, -- 实际开始时间\n\tt1.real_end_time, -- 实际结束时间\n\tt1.plan_stus, -- 计划状态\n\tt1.approve_status, -- 审批状态\n\tt1.company_id, -- 公司别\n\tt1.status, -- 状态\n\tt1.line_end_time, -- 产线停机时间\n\tt1.line_start_time, -- 产线开机时间\n\tt1.line_id, -- 产线\n\tt1.summary_user, -- 总结人\n\tt1.summary_time, -- 总结时间\n\tt1.summary_content, -- 总结内容\n\tt1.overall_leader, -- 检修整体负责人\n\tt1.flow_id, -- 审批流id\n\tt1.approve_time, -- 审批时间(计划审批后或计划变更审批后)\n\tt1.approver_list, -- 审批群组\n\tt1.spare_cost, -- 备件总费用(新增)\n\tt1.material_cost, -- 材料总费用(新增)\n\tt1.pro_cost, -- 施工总费用(新增)\n\tt1.other_cost, -- 其他总费用(新增)\n\tt1.contract_cost, -- 外委合同价(新增)\n\tt1.labor_cost, -- 外委人工费(新增)\n\tt2.task_no, -- 工单编号\n\tt2.eq_no, -- 设备编码\n\tt2.resp_user_id, -- 负责人员(检修单位)\n\tt2.resp_dept_id, -- 负责单位(检修单位)\n\tt2.work_date, -- 工作日期\n\tt2.job_cont, -- 工作内容\n\tt2.task_type, -- 工单类型\n\tt2.major_danger, -- 主要危险\n\tt2.safe_mesu, -- 安全措施\n\tt2.task_beg_time, -- 实际开始时间\n\tt2.task_end_time, -- 实际结束时间\n\tt2.finish_user_id, -- 完工人员\n\tt2.finish_time, -- 完工时间\n\tt2.chk_user_id, -- 验收人员\n\tt2.chk_desc, -- 验收意见\n\tt2.chk_time, -- 验收时间\n\tt2.is_pass, -- 是否合格\n\tt2.sop_id, -- SOP\n\tt2.task_stus, -- 工单状态\n\tt2.back_reason, -- 退回原因\n\tt2.remark, -- 备注\n\tt2.status, -- 状态\n\tt2.rep_plan_id, -- 检修计划id\n\tt2.is_over_time_unfinish, -- 是否逾期未处理\n\tt2.fault, -- 故障现象\n\tt2.apply_date, -- 报修日期\n\tt2.finish_desc, -- 完工意见\n\tt2.is_finish, -- 是否完工\n\tt2.is_accept, -- 是否接办\n\tt2.sop_ids, -- 关联sop的ID字符串集(以分号分割)\n\tt2.reason, -- 逾期未处理原因\n\tt2.task_pre_beg_time, -- 预计开始时间\n\tt2.task_pre_end_time, -- 预计结束时间\n\tt2.major_user_id, -- 专业或技术人员\n\tt2.safe_user_id, -- 安全或监护人员\n\tt2.order_id, -- 出库id\n\tt2.datum_ids, -- 维修基准id\n\tt2.eq_nos, -- 设备编号\n\tt2.object_id, -- 实物编码\n\tt2.major_danger_name, -- 主要危险名称(换行并加序号)\n\tt2.safe_mesu_name, -- 安全措施(换行并加序号)\n\tt2.work_shop_id, -- 车间id\n\tt2.lock_node, -- 上锁点\n\tt2.maint_user_id, -- 检修单位负责人\n\tt2.maint_dept_id, -- 检修单位\n\tt2.time_length, -- 检修时长\n\tt2.time_length_pre, -- 预计检修时长\n\tt2.is_schedule, -- 是否属于排程\n\tt2.eq_major, -- 专业\n\tt2.apply_user_id, -- 报修人员\n\tt2.apply_dept_id, -- 报修单位\n\tt2.chk_user_id_business, -- 验收人员(事业部)\n\tt2.chk_desc_business, -- 验收意见(事业部)\n\tt2.chk_time_business, -- 验收时间(事业部)\n\tt2.chk_user_id_company, -- 验收人员(制造部)\n\tt2.chk_desc_company, -- 验收意见(制造部)\n\tt2.chk_time_company, -- 验收时间(制造部)\n\tt2.chk_stus, -- 验收状态(1第一步验收_2第二步验收_3第三步验收)\n\tt2.chk_level, -- 验收级别(1一级验收_2二级验收_3三级验收)\n\tt2.maint_dept_out, -- 协力单位\n\tt2.chk_user_id_back, -- 验收人员(修改前)\n\tt2.chk_user_id_business_back, -- 验收人员(事业部)(修改前)\n\tt2.chk_user_id_company_back, -- 验收人员(制造部)(修改前)\n\tt2.is_consume, -- 是否备件消耗\n\tt2.is_important, -- 是否重点项目\n\tt2.danger_level, -- 危险作业等级\n\tt2.chk_back_reason, -- 验收退回原因(新增字段)\n\tt2.confirm_user_no, -- 确认人员\n\tt2.confirm_time, -- 确认时间\n\tt2.real_user_num, -- 实际完工人数\n\tt3.task_id, -- 工单id\n\tt3.object_no, -- 实物编码\n\tt3.mtrl_id, -- 物料id\n\tt3.mtrl_qty, -- 消耗的数量\n\tt3.price, -- 单价\n\tt3.total_price, -- 总价\n\tt3.storage, -- 出库储位\n\tt3.batch_no, -- 批号\n\tt3.supplier, -- 供应商\n\tt3.is_change, -- 是否备件更换\n\tt3.change_qty, -- 备件更换数量\n\tt3.repair_qty, -- 备件修理数量\n\tt3.rv_qty, -- 备件报废数量\n\tt3.keep_qty, -- 备件保养数量\n\tt3.online_date, -- 备件上线日期\n\tt3.off_place, -- 备件下线位置\n\tt3.remark, -- 备注\n\tt3.status, -- 状态\n\tt3.sop_mtrl_id, -- 检修作业备件id\n\tt3.out_store_type, -- 出库方式\n\tt3.on_place, -- 备件上线位置\n\tt3.offline_date, -- 备件下线日期\n\tt3.consume_remark -- 消耗异常备注\nFROM\n\tdwi_eqp.dwi_eqp_mb_rep_plan t1\n\tLEFT JOIN dwi_eqp.dwi_eqp_mb_task t2 ON t1.id = t2.rep_plan_id\n\tLEFT JOIN dwi_eqp.dwi_eqp_mb_task_mtrl t3 ON t2.id = t3.task_id",
	"currentDatabase":"dwi_prd",
	"description":"",
	"directory":"/廉政专项/设备智维/HIVE",
	"name":"etl_dwi_eqp_lz_eqp_maintenance_data",
	"owner":"jh_zhaochenlong",
	"templateVersion":"1.0",
	"type":"SparkSQL"
}