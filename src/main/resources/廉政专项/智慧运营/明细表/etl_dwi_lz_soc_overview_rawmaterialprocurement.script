{
	"configuration":{},
	"connectionName":"MRS_Spark_Agent",
	"content":"-- ******************************************************************** --\n-- author: jh_caiyi\n-- create time: 2025-07-15\n-- descr: 智慧运营中心专线-原燃料采购数据明细\n-- ******************************************************************** --\n-- DROP TABLE IF EXISTS dwi_qlt.dwi_qlt_soc_overview_abnormaldata;\n-- CREATE TABLE\n--     dwi_qlt.dwi_qlt_soc_overview_abnormaldata (\n--     key VARCHAR(500),\n--     ysbhg VARCHAR(500),\n--     clsjz VARCHAR(500),\n--     etl_date DATE \n--     )\n-- COMMENT '廉政八项-智慧运营中心专线-原燃料采购数据明细'\n-- -- PARTITIONED BY (mt STRING COMMENT '分区月份')\n-- STORED AS ORC;\n-- SELECT * FROM dwi_qlt.dwi_qlt_soc_overview_abnormaldata\n-- INSERT OVERWRITE TABLE\n-- \tdwi_qlt.dwi_qlt_soc_overview_abnormaldata PARTITION(mt= DATE_FORMAT(CURRENT_DATE(),'yyyyMM'))\nINSERT OVERWRITE TABLE\n\tdwi_qlt.dwi_qlt_soc_overview_abnormaldata\nSELECT *,current_date() from (\n-- sql: -数据异常报警 ranks-排序 key-键 ysbhg-验收不合格数 clsjz-超历史极值数\n              select\n                     '铁料'as key\n                   , a.ysbhg\n                   , b.clsjz\n              from\n                     (\n                            SELECT\n                                   COUNT(DISTINCT SMP_NO) ysbhg\n                            FROM\n                                   dwi_qlt.dwi_qlt_tx_sampinfo_lz\n                            WHERE\n                                   JUDG_DAY = DATE_FORMAT(CURRENT_DATE(), 'yyyyMMdd')\n                                   AND SUB_MAT_NO IN ('A'\n                                                    , 'K'\n                                                    , 'Q'\n                                                    , 'R'\n                                                    , 'T'\n                                                    , 'W')\n                                   AND JUDG_RST IN ('不合格'\n                                                  , '级外')\n                     )\n                     a\n                   , (\n                            SELECT\n                                   COUNT(DISTINCT A.SMP_NO) clsjz\n                            FROM\n                                   dwi_qlt.dwi_qlt_tx_sampinfo_lz    A\n                                 , dwi_qlt.dwi_qlt_tx_judg_record_lz B\n                            WHERE\n                                   JUDG_DAY = DATE_FORMAT(CURRENT_DATE(), 'yyyyMMdd')\n                                   AND SUB_MAT_NO IN ('A'\n                                                    , 'K'\n                                                    , 'Q'\n                                                    , 'R'\n                                                    , 'T'\n                                                    , 'W')\n                                   AND A.SMP_NO   = B.SMP_NO\n                                   AND A.SMP_TYPE = B.SMP_TYPE\n                                   AND B.FLAG    != '2'\n                                   AND B.KIND     = '2'\n                     )\n                     b\n              union all\n              select\n                     '煤焦'as key\n                   , c.ysbhg\n                   , d.clsjz\n              from\n                     (\n                            SELECT\n                                   COUNT(DISTINCT SMP_NO) ysbhg\n                            FROM\n                                   dwi_qlt.dwi_qlt_tx_sampinfo_lz\n                            WHERE\n                                   JUDG_DAY = DATE_FORMAT(CURRENT_DATE(), 'yyyyMMdd')\n                                   AND SUB_MAT_NO IN ('CK'\n                                                    , 'CM')\n                                   AND JUDG_RST IN ('不合格'\n                                                  , '级外')\n                     )\n                     c\n                   , (\n                            SELECT\n                                   COUNT(DISTINCT A.SMP_NO) clsjz\n                            FROM\n                                   dwi_qlt.dwi_qlt_tx_sampinfo_lz    A\n                                 , dwi_qlt.dwi_qlt_tx_judg_record_lz B\n                            WHERE\n                                   JUDG_DAY = DATE_FORMAT(CURRENT_DATE(), 'yyyyMMdd')\n                                   AND SUB_MAT_NO IN ('CK'\n                                                    , 'CM')\n                                   AND A.SMP_NO   = B.SMP_NO\n                                   AND A.SMP_TYPE = B.SMP_TYPE\n                                   AND B.FLAG    != '2'\n                                   AND B.KIND     = '2'\n                     )\n                     d\n              union all\n              select\n                     '辅料'as key\n                   , e.ysbhg\n                   , f.clsjz\n              from\n                     (\n                            SELECT\n                                   COUNT(DISTINCT SMP_NO) ysbhg\n                            FROM\n                                   dwi_qlt.dwi_qlt_tx_sampinfo_lz\n                            WHERE\n                                   JUDG_DAY = DATE_FORMAT(CURRENT_DATE(), 'yyyyMMdd')\n                                   AND SUB_MAT_NO IN ('S'\n                                                    , 'EP')\n                                   AND JUDG_RST IN ('不合格'\n                                                  , '级外')\n                     )\n                     e\n                   , (\n                            SELECT\n                                   COUNT(DISTINCT A.SMP_NO) clsjz\n                            FROM\n                                   dwi_qlt.dwi_qlt_tx_sampinfo_lz    A\n                                 , dwi_qlt.dwi_qlt_tx_judg_record_lz B\n                            WHERE\n                                   JUDG_DAY = DATE_FORMAT(CURRENT_DATE(), 'yyyyMMdd')\n                                   AND SUB_MAT_NO IN ('S'\n                                                    , 'EP')\n                                   AND A.SMP_NO   = B.SMP_NO\n                                   AND A.SMP_TYPE = B.SMP_TYPE\n                                   AND B.FLAG    != '2'\n                                   AND B.KIND     = '2'\n                     )\n                     f\n              union all\n              select\n                     '合金'as key\n                   , h.ysbhg\n                   , i.clsjz\n              from\n                     (\n                            SELECT\n                                   COUNT(DISTINCT SMP_NO) ysbhg\n                            FROM\n                                   dwi_qlt.dwi_qlt_tx_sampinfo_lz\n                            WHERE\n                                   JUDG_DAY = DATE_FORMAT(CURRENT_DATE(), 'yyyyMMdd')\n                                   AND SUB_MAT_NO IN ('H'\n                                                    , 'L'\n                                                    , 'X')\n                                   AND JUDG_RST IN ('不合格'\n                                                  , '级外')\n                     )\n                     h\n                   , (\n                            SELECT\n                                   COUNT(DISTINCT A.SMP_NO) clsjz\n                            FROM\n                                   dwi_qlt.dwi_qlt_tx_sampinfo_lz    A\n                                 , dwi_qlt.dwi_qlt_tx_judg_record_lz B\n                            WHERE\n                                   JUDG_DAY = DATE_FORMAT(CURRENT_DATE(), 'yyyyMMdd')\n                                   AND SUB_MAT_NO IN ('H'\n                                                    , 'L'\n                                                    , 'X')\n                                   AND A.SMP_NO   = B.SMP_NO\n                                   AND A.SMP_TYPE = B.SMP_TYPE\n                                   AND B.FLAG    != '2'\n                                   AND B.KIND     = '2'\n                     )\n                     i\n       );",
	"currentDatabase":"dwi_qlt",
	"description":"",
	"directory":"/廉政专项/智慧运营/明细表",
	"encrypt":false,
	"name":"etl_dwi_lz_soc_overview_rawmaterialprocurement",
	"templateVersion":"1.0",
	"type":"SparkSQL"
}