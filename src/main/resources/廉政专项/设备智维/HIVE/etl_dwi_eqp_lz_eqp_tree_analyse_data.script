{
	"configuration":{},
	"connectionName":"MRS_Spark_Agent",
	"content":"-- SPARK sql \n-- ******************************************************************** --\n-- author: jh_zhaochenlong\n-- create time: 2025/05/26 13:19:24 GMT+08:00\n-- descr: 廉政八项-设备智维专线-设备树分析宽表\n-- ******************************************************************** --\n-- CREATE TABLE\n-- \tdwi_eqp.dwi_eqp_lz_eqp_tree_analyse_data (\n-- \t\teq_no STRING COMMENT '设备编码',\n-- \t\teq_name STRING COMMENT '设备名称',\n-- \t\teq_belong_level STRING COMMENT '设备层级',\n-- \t\tparent_name STRING COMMENT '父级',\n-- \t\ttype_spec STRING COMMENT '规格型号',\n-- \t\ttechnical_para STRING COMMENT '技术参数',\n-- \t\tregion_name STRING COMMENT '设备位置',\n-- \t\teq_facility STRING COMMENT '设备设施分类',\n-- \t\teq_import_level STRING COMMENT '设备级别',\n-- \t\teq_major STRING COMMENT '设备专业',\n-- \t\tspec_type STRING COMMENT '设备专项',\n-- \t\tuse_dept_name STRING COMMENT '使用单位',\n-- \t\tmaintain_dept_name STRING COMMENT '维护单位',\n-- \t\tuse_date STRING COMMENT '投用日期',\n-- \t\tproducer STRING COMMENT '制造厂商',\n-- \t\tdesign_unit STRING COMMENT '设计单位',\n-- \t\tcost_center STRING COMMENT '成本中心',\n-- \t\twork_status STRING COMMENT '设备状态',\n-- \t\tdoc_type STRING COMMENT '图纸文件类型',\n-- \t\tfile_name STRING COMMENT '图纸文件名称',\n-- \t\tfile_size STRING COMMENT '图纸文件大小',\n-- \t\tfile_url STRING COMMENT '图纸文件路径',\n-- \t\tpreview_url STRING COMMENT '图纸预览路径',\n-- \t\tmtrl_id STRING COMMENT '料号',\n-- \t\tmtrl_have_num STRING COMMENT '设备拥有物料数量',\n-- \t\tstructural_style STRING COMMENT '结构形式',\n-- \t\tquantity STRING COMMENT '数量',\n-- \t\tunit STRING COMMENT '单位',\n-- \t\testate_num STRING COMMENT '不动产证号',\n-- \t\tland_num STRING COMMENT '土地证号',\n-- \t\tcheck_contract STRING COMMENT '检测合同号',\n-- \t\tcheck_parts STRING COMMENT '检修部位',\n-- \t\tcheck_reason STRING COMMENT '检测原因',\n-- \t\tcontract_cost STRING COMMENT '合同费用',\n-- \t\tcheck_repair_beg_time STRING COMMENT '检测开始时间',\n-- \t\tcheck_repair_end_time STRING COMMENT '检测结束时间',\n-- \t\tplan_no STRING COMMENT '项目计划号',\n-- \t\tcontract_no STRING COMMENT '立项号',\n-- \t\tplan_name STRING COMMENT '项目名称',\n-- \t\trecondition_parts STRING COMMENT '维修部位',\n-- \t\trecondition_area STRING COMMENT '维修面积',\n-- \t\trecondition_reason STRING COMMENT '维修理由',\n-- \t\tproject_cost STRING COMMENT '立项费用',\n-- \t\trecondition_plan_result STRING COMMENT '维修方案及效果',\n-- \t\trecondition_beg_time STRING COMMENT '维修开始时间',\n-- \t\trecondition_end_time STRING COMMENT '维修结束时间',\n-- \t\tuse_dept_id STRING COMMENT '使用单位ID',\n-- \t\tuse_dept_no STRING COMMENT '使用单位编号',\n-- \t\tmaintain_dept_id STRING COMMENT '维护单位ID',\n-- \t\tmaintain_dept_no STRING COMMENT '维护单位编号',\n-- \t\teq_id STRING COMMENT '设备ID',\n-- \t\tparent_id STRING COMMENT '父级ID',\n-- \t\tarea_id STRING COMMENT '设备位置ID',\n-- \t\tbussiness_no STRING COMMENT '事业部编号',\n-- \t\tfactory_no STRING COMMENT '生产厂编号',\n-- \t\teq_create_date_time STRING COMMENT '设备创建时间',\n-- \t\teq_create_user_no STRING COMMENT '设备创建人',\n-- \t\tmtrl_create_date_time STRING COMMENT '备件包创建时间',\n-- \t\tmtrl_create_user_name STRING COMMENT '备件包创建人',\n-- \t\tpic_create_date_time STRING COMMENT '图纸创建时间',\n-- \t\tpic_create_user_name STRING COMMENT '图纸创建人'\n-- \t) COMMENT '廉政八项-设备智维专线-设备树分析宽表' STORED AS orc TBLPROPERTIES (\"orc.compress\" = \"SNAPPY\");\n\nINSERT OVERWRITE TABLE\n\tdwi_eqp.dwi_eqp_lz_eqp_tree_analyse_data (\n\t\teq_no,\n\t\teq_name,\n\t\teq_belong_level,\n\t\tparent_name,\n\t\ttype_spec,\n\t\ttechnical_para,\n\t\tregion_name,\n\t\teq_facility,\n\t\teq_import_level,\n\t\teq_major,\n\t\tspec_type,\n\t\tuse_dept_name,\n\t\tmaintain_dept_name,\n\t\tuse_date,\n\t\tproducer,\n\t\tdesign_unit,\n\t\tcost_center,\n\t\twork_status,\n\t\tdoc_type,\n\t\tfile_name,\n\t\tfile_size,\n\t\tfile_url,\n\t\tpreview_url,\n\t\tmtrl_id,\n\t\tmtrl_have_num,\n    \tstructural_style, \n    \tquantity, \n    \tunit, \n    \testate_num, \n    \tland_num,\n    \tcheck_contract, \n    \tcheck_parts, \n    \tcheck_reason, \n    \tcontract_cost, \n    \tcheck_repair_beg_time , \n    \tcheck_repair_end_time , \n    \tplan_no, \n    \tcontract_no, \n    \tplan_name, \n    \trecondition_parts, \n    \trecondition_area, \n    \trecondition_reason, \n    \tproject_cost,\n    \trecondition_plan_result, \n    \trecondition_beg_time, \n    \trecondition_end_time, \n\t\tuse_dept_id,\n\t\tuse_dept_no,\n\t\tmaintain_dept_id,\n\t\tmaintain_dept_no,\n\t\teq_id,\n\t\tparent_id,\n\t\tarea_id,\n\t\tbussiness_no,\n\t\tfactory_no,\n\t\teq_create_date_time,\n\t\teq_create_user_no,\n\t\tmtrl_create_date_time,\n\t\tmtrl_create_user_name,\n\t\tpic_create_date_time,\n\t\tpic_create_user_name\n\t)\nSELECT\n\tma_eq.eq_no AS eq_no, -- 设备编码\n\tma_eq.eq_name AS eq_name, -- 设备名称\n\tsys_dictionary_dtl1.str_value AS eq_belong_level, -- 设备层级\n\tma_eq1.eq_name AS parent_name, -- 父级\n\tma_eq.type_spec AS type_spec, -- 规格型号\n\tma_eq.technical_para AS technical_para, -- 技术参数\n\tma_area.region_name AS region_name, -- 设备位置\n\tsys_dictionary_dtl2.str_value AS eq_facility, -- 设备设施分类\n\tsys_dictionary_dtl3.str_value AS eq_import_level, -- 设备级别\n\tsys_dictionary_dtl4.str_value AS eq_major, -- 设备专业\n\tsys_dictionary_dtl5.str_value AS spec_type, -- 设备专项\n\tCASE\n\t\tWHEN ma_eq.use_dept_id = 'X60000100/X60000400' THEN '中棒厂机修作业区/中棒厂生产作业区'\n\t\tWHEN ma_eq.use_dept_id = 'X60000200/X60000100' THEN '中棒厂电修作业区/中棒厂机修作业区'\n\t\tWHEN ma_eq.use_dept_id = '第一、第三炼钢厂' THEN '第一炼钢厂/第三炼钢厂'\n\t\tWHEN ma_eq.use_dept_id = '第一、第三炼钢厂，科技质量部钢轧检验站' THEN '第一炼钢厂/第三炼钢厂/钢轧检验站'\n\t\tWHEN ma_eq.use_dept_id = '科技质量部钢轧检验站' THEN '钢轧检验站'\n\t\tWHEN LENGTH(ma_eq.use_dept_id) = 9 THEN hr_department2.str_name\n\t\tELSE hr_department.str_name\n\tEND AS use_dept_name, -- 使用单位\n\tCASE\n\t\tWHEN ma_eq.maintain_dept_id = '/' THEN ''\n\t\tWHEN ma_eq.maintain_dept_id = 'X60000200/X60000100' THEN '中棒厂电修作业区/中棒厂机修作业区'\n\t\tWHEN ma_eq.maintain_dept_id = 'X60000300/X60000200' THEN '中棒厂运行作业区/中棒厂电修作业区'\n\t\tWHEN ma_eq.maintain_dept_id = 'X60000100/X60000200' THEN '中棒厂机修作业区/中棒厂电修作业区'\n\t\tWHEN LENGTH(ma_eq.maintain_dept_id) = 36\n\t\tAND RLIKE (ma_eq.maintain_dept_id, '^[a-zA-Z0-9].*') THEN hr_department1.str_name\n\t\tWHEN LENGTH(ma_eq.maintain_dept_id) = 9\n\t\tAND RLIKE (ma_eq.maintain_dept_id, '^[a-zA-Z0-9].*') THEN hr_department3.str_name\n\t\tELSE ma_eq.maintain_dept_id\n\tEND AS maintain_dept_name, -- 维护单位\n\tma_eq.use_date AS use_date, -- 投用日期\n\tma_eq.producer AS producer, -- 制造厂商\n\tma_eq.design_unit AS design_unit, -- 设计单位\n\tma_eq.cost_center AS cost_center, -- 成本中心\n\tsys_dictionary_dtl6.str_value AS work_status, -- 设备状态\n\tma_picture_database.doc_type AS doc_type, -- 图纸文件类型\n\tma_picture_database.file_name AS file_name, -- 图纸文件名称\n\tma_picture_database.file_size AS file_size, -- 图纸文件大小\n\tma_picture_database.file_url AS file_url, -- 图纸文件路径\n\tma_picture_database.preview_url AS preview_url, -- 图纸预览路径\n\tma_eq_mtrl.mtrl_id AS mtrl_id, -- 料号\n\tma_eq_mtrl.mtrl_have_num AS mtrl_have_num, -- 设备拥有物料数量\n\tma_eq.structural_style AS structural_style, -- 结构形式\n\tma_eq.quantity AS quantity, -- 数量\n\tma_eq.unit AS unit, -- 单位\n\tma_eq.estate_num AS estate_num, -- 不动产证号\n\tma_eq.land_num AS land_num, -- 土地证号\n\tma_eq_check_repair.check_contract AS check_contract, -- 检测合同号\n\tma_eq_check_repair.check_parts AS check_parts, -- 检修部位\n\tma_eq_check_repair.check_reason AS check_reason, -- 检测原因\n\tma_eq_check_repair.contract_cost AS contract_cost,  -- 合同费用\n\tma_eq_check_repair.check_repair_beg_time AS check_repair_beg_time , --检测开始时间\n\tma_eq_check_repair.check_repair_end_time AS check_repair_end_time , --检测结束时间 \n\tma_eq_recondition.plan_no AS plan_no, -- 项目计划号\n\tma_eq_recondition.contract_no AS contract_no, -- 立项号\n\tma_eq_recondition.plan_name AS plan_name, -- 项目名称\n\tma_eq_recondition.recondition_parts AS recondition_parts, -- 维修部位\n\tma_eq_recondition.recondition_area AS recondition_area, -- 维修面积\n\tma_eq_recondition.recondition_reason AS recondition_reason, -- 维修理由  \n\tma_eq_recondition.contract_cost AS project_cost, -- 立项费用\n\tma_eq_recondition.recondition_plan_result AS recondition_plan_result, -- 维修方案及效果\n\tma_eq_recondition.check_repair_beg_time AS recondition_beg_time, -- 维修开始时间\n\tma_eq_recondition.check_repair_end_time AS recondition_end_time, -- 维修结束时间\n\tCASE\n\t\tWHEN ma_eq.use_dept_id = '/'\n\t\tOR ma_eq.use_dept_id = 'A' THEN ''\n\t\tWHEN ma_eq.use_dept_id = 'X60000100/X60000400' THEN 'fe7a3de2-d6fc-4115-891c-7a60460d7efe / d7a95308-0094-463c-a6bf-877702290393'\n\t\tWHEN ma_eq.use_dept_id = 'X60000200/X60000100' THEN 'dad43f54-fbcf-4bf6-b118-698177f41d6b / fe7a3de2-d6fc-4115-891c-7a60460d7efe'\n\t\tWHEN ma_eq.use_dept_id = '第一、第三炼钢厂' THEN '4867ac09-e5d1-4dbb-8f51-8862f99bb9fe / 03eb111e-d70e-4269-9752-ac00524190aa'\n\t\tWHEN ma_eq.use_dept_id = '第一、第三炼钢厂，科技质量部钢轧检验站' THEN '4867ac09-e5d1-4dbb-8f51-8862f99bb9fe / 03eb111e-d70e-4269-9752-ac00524190aa / f3cfebcc-2560-447c-805f-bc2230b94382'\n\t\tWHEN ma_eq.use_dept_id = '科技质量部钢轧检验站' THEN 'f3cfebcc-2560-447c-805f-bc2230b94382'\n\t\tWHEN LENGTH(ma_eq.use_dept_id) = 9 THEN hr_department2.id\n\t\tELSE ma_eq.use_dept_id\n\tEND AS use_dept_id, -- 使用单位ID\n\tCASE\n\t\tWHEN ma_eq.use_dept_id = 'X60000100/X60000400' THEN 'X60000100/X60000400'\n\t\tWHEN ma_eq.use_dept_id = 'X60000200/X60000100' THEN 'X60000200/X60000100'\n\t\tWHEN ma_eq.use_dept_id = '第一、第三炼钢厂' THEN 'X73000000/X42000000'\n\t\tWHEN ma_eq.use_dept_id = '第一、第三炼钢厂，科技质量部钢轧检验站' THEN 'X73000000/X42000000/X10090000'\n\t\tWHEN ma_eq.use_dept_id = '科技质量部钢轧检验站' THEN 'X10090000'\n\t\tWHEN LENGTH(ma_eq.use_dept_id) = 9 THEN ma_eq.use_dept_id\n\t\tELSE hr_department.str_sn\n\tEND AS use_dept_no, -- 使用单位编号\n\tCASE\n\t\tWHEN ma_eq.maintain_dept_id = 'X60000200/X60000100' THEN 'dad43f54-fbcf-4bf6-b118-698177f41d6b / fe7a3de2-d6fc-4115-891c-7a60460d7efe'\n\t\tWHEN ma_eq.maintain_dept_id = 'X60000300/X60000200' THEN 'e7fd9c21-11e5-426a-9a95-16fd57338662 / dad43f54-fbcf-4bf6-b118-698177f41d6b'\n\t\tWHEN ma_eq.maintain_dept_id = 'X60000100/X60000200' THEN 'fe7a3de2-d6fc-4115-891c-7a60460d7efe / dad43f54-fbcf-4bf6-b118-698177f41d6b'\n\t\tWHEN LENGTH(ma_eq.maintain_dept_id) = 36\n\t\tAND RLIKE (ma_eq.maintain_dept_id, '^[a-zA-Z0-9].*') THEN ma_eq.maintain_dept_id\n\t\tELSE hr_department3.id\n\tEND AS maintain_dept_id, -- 维护单位ID\n\tCASE\n\t\tWHEN ma_eq.maintain_dept_id IN ('A', '1', '2', '20110301', 'xx施工单位', '19冶') THEN ''\n\t\tWHEN ma_eq.maintain_dept_id = 'X60000200/X60000100' THEN 'X60000200/X60000100'\n\t\tWHEN ma_eq.maintain_dept_id = 'X60000300/X60000200' THEN 'X60000300/X60000200'\n\t\tWHEN ma_eq.maintain_dept_id = 'X60000100/X60000200' THEN 'X60000100/X60000200'\n\t\tWHEN NOT RLIKE (ma_eq.maintain_dept_id, '^[a-zA-Z0-9].*') THEN ''\n\t\tWHEN LENGTH(ma_eq.maintain_dept_id) = 36\n\t\tAND RLIKE (ma_eq.maintain_dept_id, '^[a-zA-Z0-9].*') THEN hr_department1.str_sn\n\t\tELSE ma_eq.maintain_dept_id\n\tEND AS maintain_dept_no, -- 维护单位编号\n\tma_eq.id AS eq_id, -- 设备id\n\tma_eq.parent_id AS parent_id, -- 父级id\n\tma_eq.area_id AS area_id, -- 设备位置id\n\tma_eq.bussiness_no AS bussiness_no, -- 事业部编号\n\tma_eq.factory_no AS factory_no, -- 生产厂编号\n\tma_eq.create_date_time AS eq_create_date_time, -- 设备创建时间\n\thr_user2.name AS eq_create_user_no, -- 设备创建人 \n\tma_eq_mtrl.create_date_time AS mtrl_create_date_time, -- 备件包创建时间\n\thr_user.name AS mtrl_create_user_name, -- 备件包创建人\n\tma_picture_database.create_date_time AS pic_create_date_time, -- 图纸创建时间\n\thr_user1.name AS pic_create_user_name -- 图纸创建人\nFROM\n\t( SELECT * FROM dwi_eqp.dwi_eqp_ma_eq WHERE status = 1 ) ma_eq\n\tLEFT JOIN \n\t    ( SELECT * FROM dwi_eqp.dwi_eqp_ma_area WHERE status = 1 ) ma_area \n\t    ON ma_eq.area_id = ma_area.id\n\tLEFT JOIN \n\t    ( SELECT * FROM dwi_eqp.dwi_eqp_ma_picture_database WHERE status = 1 ) ma_picture_database \n\t    ON ma_eq.id = ma_picture_database.relative_id\n\tLEFT JOIN \n\t    ( SELECT * FROM dwi_eqp.dwi_eqp_ma_eq_mtrl WHERE status = 1 ) ma_eq_mtrl \n\t    ON ma_eq.id = ma_eq_mtrl.eq_id\n\tLEFT JOIN \n\t    ( SELECT * FROM dwi_eqp.dwi_eqp_ma_eq_check_repair WHERE status = 1 ) ma_eq_check_repair \n\t    ON ma_eq_check_repair.eq_id = ma_eq.id\n\tLEFT JOIN \n\t    ( SELECT * FROM dwi_eqp.dwi_eqp_ma_eq_recondition WHERE status = 1 ) ma_eq_recondition \n\t    ON ma_eq_recondition.eq_id = ma_eq.id\n\tLEFT JOIN \n\t    ( SELECT * FROM dwi_eqp.dwi_eqp_sys_dictionary_dtl WHERE dict_sn = 'eqBelongLevel' ) sys_dictionary_dtl1 \n\t    ON ma_eq.eq_belong_level = sys_dictionary_dtl1.str_key\n\tLEFT JOIN \n\t    ( SELECT * FROM dwi_eqp.dwi_eqp_ma_eq WHERE status = 1 ) ma_eq1 \n\t    ON ma_eq.parent_id = ma_eq1.id\n\tLEFT JOIN \n\t    ( SELECT * FROM dwi_eqp.dwi_eqp_sys_dictionary_dtl WHERE dict_sn = 'eqFacility' ) sys_dictionary_dtl2 \n\t    ON ma_eq.eq_facility = sys_dictionary_dtl2.str_key\n\tLEFT JOIN \n\t    ( SELECT * FROM dwi_eqp.dwi_eqp_sys_dictionary_dtl WHERE dict_sn = 'eqImportLevel' ) sys_dictionary_dtl3 \n\t    ON ma_eq.eq_import_level = sys_dictionary_dtl3.str_key\n\tLEFT JOIN \n\t    ( SELECT * FROM dwi_eqp.dwi_eqp_sys_dictionary_dtl WHERE dict_sn = 'eqMajor' ) sys_dictionary_dtl4 \n\t    ON ma_eq.eq_major = sys_dictionary_dtl4.str_key\n\tLEFT JOIN \n\t    ( SELECT * FROM dwi_eqp.dwi_eqp_sys_dictionary_dtl WHERE dict_sn = 'specialType' ) sys_dictionary_dtl5 \n\t    ON ma_eq.spec_type = sys_dictionary_dtl5.str_key\n\tLEFT JOIN \n\t    dwi_eqp.dwi_eqp_hr_department hr_department \n\t    ON ma_eq.use_dept_id = hr_department.id\n\tLEFT JOIN \n\t    dwi_eqp.dwi_eqp_hr_department hr_department1 \n\t    ON ma_eq.maintain_dept_id = hr_department1.id\n\tLEFT JOIN \n\t    dwi_eqp.dwi_eqp_hr_department hr_department2 \n\t    ON ma_eq.use_dept_id = hr_department2.str_sn\n\tLEFT JOIN \n\t    dwi_eqp.dwi_eqp_hr_department hr_department3 \n\t    ON ma_eq.maintain_dept_id = hr_department3.str_sn\n\tLEFT JOIN \n\t    ( SELECT * FROM dwi_eqp.dwi_eqp_sys_dictionary_dtl WHERE dict_sn = 'workStatus' ) sys_dictionary_dtl6 \n\t    ON ma_eq.work_status = sys_dictionary_dtl6.str_key\n\tLEFT JOIN \n\t    dwi_eqp.dwi_eqp_hr_user hr_user \n\t    ON ma_eq_mtrl.create_user_no = hr_user.user_no\n\tLEFT JOIN \n\t    dwi_eqp.dwi_eqp_hr_user hr_user1 \n\t    ON ma_picture_database.create_user_no = hr_user1.user_no\n\tLEFT JOIN \n\t    dwi_eqp.dwi_eqp_hr_user hr_user2 \n\t    ON ma_eq.create_user_no = hr_user2.user_no;",
	"currentDatabase":"dwi_eqp",
	"description":"",
	"directory":"/廉政专项/设备智维/HIVE",
	"name":"etl_dwi_eqp_lz_eqp_tree_analyse_data",
	"owner":"jh_zhaochenlong",
	"templateVersion":"1.0",
	"type":"SparkSQL"
}