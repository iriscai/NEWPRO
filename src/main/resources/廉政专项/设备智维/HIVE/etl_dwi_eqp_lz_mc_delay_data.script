{
	"configuration":{},
	"connectionName":"MRS_Spark_Agent",
	"content":"-- SPARK sql \n-- ******************************************************************** --\n-- author: jh_zhaochenlong\n-- create time: 2025/05/26 11:08:22 GMT+08:00\n-- descr：廉政八项-设备智维专线-延误信息宽表\n-- ******************************************************************** --\n-- DROP TABLE IF EXISTS dwi_eqp.dwi_eqp_lz_mc_delay_data;\n-- CREATE TABLE\n-- \tdwi_eqp.dwi_eqp_lz_mc_delay_data (\n-- \t\tdelay_no                STRING COMMENT '延误记录编号',\n-- \t\tline_id                 STRING COMMENT '产线ID',\n-- \t\tline_name               STRING COMMENT '产线名称',\n-- \t\tfactory_id              STRING COMMENT '生产厂ID',\n-- \t\tfactory_name            STRING COMMENT '生产厂名称',\n-- \t\teq_id                   STRING COMMENT '设备ID',\n-- \t\teq_name                 STRING COMMENT '设备名称',\n-- \t\tis_plan                 STRING COMMENT '是否计划',\n-- \t\tfirst_reason            STRING COMMENT '延误初判原因',\n-- \t\tfinal_reason            STRING COMMENT '延误终判原因',\n-- \t\tstop_beg_time           STRING COMMENT '停机开始时间',\n-- \t\tstop_end_time           STRING COMMENT '停机结束时间',\n-- \t\tuser_stop_beg_time      STRING COMMENT '手动开始时间',\n-- \t\tuser_stop_end_time      STRING COMMENT '手动结束时间',\n-- \t\tstop_hour               DECIMAL(6, 2) COMMENT '停机时长',\n-- \t\tresp_line_id            STRING COMMENT '责任产线ID',\n-- \t\tresp_line_name          STRING COMMENT '责任产线名称',\n-- \t\tresp_dept_id            STRING COMMENT '责任部门ID',\n-- \t\tresp_dept_name          STRING COMMENT '责任部门名称',\n-- \t\trep_plan_id             STRING COMMENT '关联检修计划ID',\n-- \t\tback_reason             STRING COMMENT '退回原因',\n-- \t\tdelay_stus              STRING COMMENT '延误记录状态',\n-- \t\trecord_stop_type        DECIMAL(1, 0) COMMENT '停机类型(自动_手动)',\n-- \t\trecord_type             STRING COMMENT '记录类型',\n-- \t\tsource_record_ids       STRING COMMENT '原始记录ID集',\n-- \t\treport_id               STRING COMMENT '延误报告ID',\n-- \t\tback_num                DECIMAL (1, 0) COMMENT '退回次数',\n-- \t\tflow_request_id         STRING COMMENT '工作流ID',\n-- \t\trecord_remark           STRING COMMENT '延误记录备注',\n-- \t\tline_stop_id            STRING COMMENT '开停机信号ID',\n-- \t\tfirst_judge_user_no     STRING COMMENT '初判人',\n-- \t\tfirst_judge_date_time   STRING COMMENT '初判时间',\n-- \t\tfinal_judge_user_no     STRING COMMENT '终判人',\n-- \t\tfinal_judge_date_time   STRING COMMENT '终判时间',\n-- \t\tfault_sign_user_no      STRING COMMENT '误报人',\n-- \t\tfault_sign_date_time    STRING COMMENT '误报时间',\n-- \t\tcommunication_status    STRING COMMENT '通讯状态',\n-- \t\tcompany_id              STRING COMMENT '公司别',\n-- \t\tstatus                  DECIMAL(1, 0) COMMENT '数据状态',\n-- \t\tproduct_delay_tag       STRING COMMENT '生产延误标记',\n-- \t\tdelay_product_group     STRING COMMENT '生产延误归类',\n-- \t\tfault_sign_reason       STRING COMMENT '误报原因',\n-- \t\teffect_level            STRING COMMENT '影响等级',\n-- \t\tscore_one               STRING COMMENT '调度初判分数',\n-- \t\tscore_two               STRING COMMENT '专业判定分数',\n-- \t\tis_delay                STRING COMMENT '是否延误(0停机_1延误)',\n-- \t\tchange_flow_id          STRING COMMENT '变更流程ID',\n-- \t\tchange_reason           STRING COMMENT '变更原因',\n-- \t\tbefore_change_stus      STRING COMMENT '变更前状态',\n-- \t\tproduct_plan_id         STRING COMMENT '停机申报对应ID',\n-- \t\tpre_plan_id             STRING COMMENT '检修预排ID',\n-- \t\treject_reason           STRING COMMENT '驳回原因',\n-- \t\tjh_flow_id              STRING COMMENT '计划流程ID',\n-- \t\tdelay_report_no         STRING COMMENT '延误报告编号',\n-- \t\tdelay_id                STRING COMMENT '延误记录ID',\n-- \t\teq_stop_id              STRING COMMENT '设备停机记录ID',\n-- \t\tdelay_level             STRING COMMENT '延误级别',\n-- \t\tresp_user_id            STRING COMMENT '责任人',\n-- \t\tacd_reason              STRING COMMENT '事故原因归类',\n-- \t\tdelay_beg_time          STRING COMMENT '延误开始时间',\n-- \t\tdelay_end_time          STRING COMMENT '延误结束时间',\n-- \t\tdelay_hour              DECIMAL(8, 0) COMMENT '延误时长',\n-- \t\tresp_user_no            STRING COMMENT '专业主管工号',\n-- \t\tresp_user_name          STRING COMMENT '专业主管姓名',\n-- \t\tspotcheck_user_no       STRING COMMENT '点检员工号',\n-- \t\tspotcheck_user_name     STRING COMMENT '点检员姓名',\n-- \t\treport_type             STRING COMMENT '报告类别',\n-- \t\treport_group_type       STRING COMMENT '报告大类',\n-- \t\treport_final_name       STRING COMMENT '故障名称固定',\n-- \t\treport_name             STRING COMMENT '故障名称拆',\n-- \t\treport_no               STRING COMMENT '故障编号',\n-- \t\tresp_factory_id         STRING COMMENT '责任厂',\n-- \t\tacd_process_solveway    STRING COMMENT '故障处置经过(原发生经过加上排除经过)',\n-- \t\tacd_analyze             STRING COMMENT '故障原因分析(原事故原因分析及事故教训)',\n-- \t\tacd_reason_direct       STRING COMMENT '直接原因',\n-- \t\tacd_reason_manage       STRING COMMENT '管理原因',\n-- \t\tacd_reason_technique    STRING COMMENT '技术原因',\n-- \t\ttotal_loss              DECIMAL(8, 0) COMMENT '事故总损失',\n-- \t\trep_cost                DECIMAL(8, 0) COMMENT '设备修复费',\n-- \t\tredu_qty                DECIMAL(8, 0) COMMENT '减产数量',\n-- \t\tredu_loss               DECIMAL(8, 0) COMMENT '减产损失费',\n-- \t\tpart_cost               DECIMAL(8, 0) COMMENT '备件费用',\n-- \t\tmate_cost               DECIMAL(8, 0) COMMENT '材料费用',\n-- \t\tman_cost                DECIMAL(8, 0) COMMENT '人工费用',\n-- \t\tother_cost              DECIMAL(8, 0) COMMENT '其它费用',\n-- \t\tdamage_range            STRING COMMENT '损坏情况及影响范围',\n-- \t\tdelay_reason            STRING COMMENT '延误原因概述',\n-- \t\tis_over_time            STRING COMMENT '是否超合理维修时间',\n-- \t\tacd_process             STRING COMMENT '事故发生经过',\n-- \t\tacd_solve_way           STRING COMMENT '排除事故的技术措施及经过',\n-- \t\tacd_lesson              STRING COMMENT '事故原因分析及事故教训',\n-- \t\treport_stus             STRING COMMENT '报告状态',\n-- \t\tapprove_status          STRING COMMENT '报告流程状态',\n-- \t\tkeywords                STRING COMMENT '关键字',\n-- \t\teq_no                   STRING COMMENT '设备编码',\n-- \t\teq_object_id            STRING COMMENT '设备实物编码',\n-- \t\tinstance_id             STRING COMMENT '审批流示例ID',\n-- \t\tapply_user_no           STRING COMMENT '发起人',\n-- \t\tapply_date_time         STRING COMMENT '发起时间',\n-- \t\tflow_end_date_time      STRING COMMENT '审批完成时间',\n-- \t\treport_remark           STRING COMMENT '延误报告备注',\n-- \t\treform_type             STRING COMMENT '整改类型',\n-- \t\treform_content          STRING COMMENT '整改措施',\n-- \t\tpre_finish_time         STRING COMMENT '预计完成时间',\n-- \t\treal_finish_time        STRING COMMENT '实际完成时间',\n-- \t\tdeal_way                STRING COMMENT '措施处理方式',\n-- \t\tcheck_result            STRING COMMENT '措施验证结果',\n-- \t\tcheck_user_id           STRING COMMENT '验证人',\n-- \t\twork_task_id            STRING COMMENT '工作任务单ID',\n-- \t\treform_stus             STRING COMMENT '整改措施状态',\n-- \t\treform_valid            STRING COMMENT '措施是否有效',\n-- \t\treform_remark           STRING COMMENT '延误整改备注'\n-- \t) COMMENT '廉政八项-设备智维专线-延误信息宽表' STORED AS orc TBLPROPERTIES (\"orc.compress\" = \"SNAPPY\");\nINSERT OVERWRITE TABLE \n    dwi_eqp.dwi_eqp_lz_mc_delay_data \nSELECT \n    t1.delay_no,                -- 延误记录编号\n    t1.line_id,                 -- 产线ID\n    t4.line_name,               -- 产线名称\n    t1.factory_id,              -- 生产厂ID\n    t5.str_name,            -- 生产厂名称\n    t1.eq_id,                   -- 设备ID\n    ma_eq.eq_name,                 -- 设备名称\n    t1.is_plan,                 -- 是否计划\n    t1.first_reason,          -- 延误初判原因\n    t1.final_reason,          -- 延误终判原因\n    t1.stop_beg_time,          -- 停机开始时间\n    t1.stop_end_time,          -- 停机结束时间\n    t1.user_stop_beg_time,          -- 手动开始时间\n    t1.user_stop_end_time,          -- 手动结束时间\n    t1.stop_hour,          -- 停机时长\n    t1.resp_line_id,          -- 责任产线ID\n    t4.line_name,          -- 责任产线名称\n    t1.resp_dept_id,          -- 责任部门ID\n    hr_department2.str_name,          -- 责任部门名称\n    t1.rep_plan_id,          -- 关联检修计划ID\n    t1.back_reason,          -- 退回原因\n    t1.delay_stus,          -- 延误记录状态\n    t1.record_stop_type,          -- 停机类型(自动_手动)\n    t1.record_type,          -- 记录类型\n    t1.source_record_ids,          -- 原始记录ID集\n    t1.report_id,          -- 延误报告ID\n    t1.back_num,          -- 退回次数\n    t1.flow_request_id,          -- 工作流ID\n    t1.remark,          -- 延误记录备注\n    t1.line_stop_id,          -- 开停机信号ID\n    t1.first_judge_user_no,          -- 初判人\n    t1.first_judge_date_time,          -- 初判时间\n    t1.final_judge_user_no,          -- 终判人\n    t1.final_judge_date_time,          -- 终判时间\n    t1.fault_sign_user_no,          -- 误报人\n    t1.fault_sign_date_time,          -- 误报时间\n    t1.communication_status,          -- 通讯状态\n    t1.company_id,          -- 公司别\n    t1.status,          -- 数据状态\n    t1.product_delay_tag,          -- 生产延误标记\n    t1.delay_product_group,          -- 生产延误归类\n    t1.fault_sign_reason,          -- 误报原因\n    t1.effect_level,          -- 影响等级\n    t1.score_one,          -- 调度初判分数\n    t1.score_two,          -- 专业判定分数\n    t1.is_delay,          -- 是否延误(0停机_1延误)\n    t1.change_flow_id,          -- 变更流程ID\n    t1.change_reason,          -- 变更原因\n    t1.before_change_stus,          -- 变更前状态\n    t1.product_plan_id,          -- 停机申报对应ID\n    t1.pre_plan_id,          -- 检修预排ID\n    t1.reject_reason,          -- 驳回原因\n    t1.jh_flow_id,          -- 计划流程ID\n    t2.delay_report_no,          -- 延误报告编号\n    t2.delay_id,          -- 延误记录ID\n    t2.eq_stop_id,          -- 设备停机记录ID\n    t2.delay_level,          -- 延误级别\n    t2.resp_user_id,          -- 责任人\n    t2.acd_reason,          -- 事故原因归类\n    t2.delay_beg_time,          -- 延误开始时间\n    t2.delay_end_time,          -- 延误结束时间\n    t2.delay_hour,          -- 延误时长\n    t2.resp_user_no,          -- 专业主管工号\n    t2.resp_user_name,          -- 专业主管姓名\n    t2.spotcheck_user_no,          -- 点检员工号\n    t2.spotcheck_user_name,          -- 点检员姓名\n    t2.report_type,          -- 报告类别\n    t2.report_group_type,          -- 报告大类\n    t2.report_final_name,          -- 故障名称固定\n    t2.report_name,          -- 故障名称拆\n    t2.report_no,          -- 故障编号\n    t2.resp_factory_id,          -- 责任厂\n    t2.acd_process_solveway,          -- 故障处置经过(原发生经过加上排除经过)\n    t2.acd_analyze,          -- 故障原因分析(原事故原因分析及事故教训)\n    t2.acd_reason_direct,          -- 直接原因\n    t2.acd_reason_manage,          -- 管理原因\n    t2.acd_reason_technique,          -- 技术原因\n    t2.total_loss,          -- 事故总损失\n    t2.rep_cost,          -- 设备修复费\n    t2.redu_qty,          -- 减产数量\n    t2.redu_loss,          -- 减产损失费\n    t2.part_cost,          -- 备件费用\n    t2.mate_cost,          -- 材料费用\n    t2.man_cost,          -- 人工费用\n    t2.other_cost,          -- 其它费用\n    t2.damage_range,          -- 损坏情况及影响范围\n    t2.delay_reason,          -- 延误原因概述\n    t2.is_over_time,          -- 是否超合理维修时间\n    t2.acd_process,          -- 事故发生经过\n    t2.acd_solve_way,          -- 排除事故的技术措施及经过\n    t2.acd_lesson,          -- 事故原因分析及事故教训\n    t2.report_stus,          -- 报告状态\n    t2.approve_status,          -- 报告流程状态\n    t2.keywords,          -- 关键字\n    t2.eq_no,          -- 设备编码\n    t2.eq_object_id,          -- 设备实物编码\n    t2.instance_id,          -- 审批流示例ID\n    t2.apply_user_no,          -- 发起人\n    t2.apply_date_time,          -- 发起时间\n    t2.flow_end_date_time,          -- 审批完成时间\n    t2.remark,          -- 延误报告备注\n    t3.reform_type,          -- 整改类型\n    t3.reform_content,          -- 整改措施\n    t3.pre_finish_time,          -- 预计完成时间\n    t3.real_finish_time,          -- 实际完成时间\n    t3.deal_way,          -- 措施处理方式\n    t3.check_result,          -- 措施验证结果\n    t3.check_user_id,          -- 验证人\n    t3.work_task_id,          -- 工作任务单ID\n    t3.reform_stus,          -- 整改措施状态\n    t3.reform_valid,          -- 措施是否有效\n    t3.remark          -- 延误整改备注\nFROM \n    (SELECT * FROM dwi_eqp.dwi_eqp_mc_delay_record WHERE status = 1) t1\nLEFT JOIN\n     (SELECT * FROM dwi_eqp.dwi_eqp_mc_delay_report WHERE status = 1) t2\n    ON t1.id = t2.delay_id\nLEFT JOIN\n     (SELECT * FROM dwi_eqp.dwi_eqp_mc_delay_reform WHERE status = 1) t3\n    ON t2.id = t3.delay_report_id\nLEFT JOIN\n     (SELECT\n           mc_line_list.line_name AS line_name,\n           mc_line_list.factory_id AS factory_id,\n           mc_line_list.line_no AS line_no,\n           mj_rule.rule_desc AS rule_desc,\n           mc_line_list.id AS mc_line_list_id,\n           mc_line_list.line_type AS mc_line_list_line_type,\n           mj_rule.id AS mj_rule_id,\n           mj_rule.eqid_or_lineno AS mj_rule_eqid_or_lineno\n      FROM (SELECT * FROM dwi_eqp.dwi_eqp_mc_line_list WHERE status = 1) mc_line_list\n      LEFT JOIN (SELECT * FROM dwi_eqp.dwi_eqp_mj_rule where status = 1 AND eqline_type = '2') mj_rule\n           ON mj_rule.eqid_or_lineno = mc_line_list.line_no\n     ) t4\n    ON t1.line_id = t4.mc_line_list_id\nLEFT JOIN \n    dwi_eqp.dwi_eqp_hr_department t5\n    ON t4.factory_id = t5.id\nLEFT JOIN \n     (SELECT * FROM dwi_eqp.dwi_eqp_ma_eq WHERE status = 1) ma_eq\n    ON t1.eq_id = ma_eq.id\nLEFT JOIN \n    dwi_eqp.dwi_eqp_hr_department hr_department2\n    ON t1.resp_dept_id = hr_department2.id;",
	"currentDatabase":"dwi_eqp",
	"description":"",
	"directory":"/廉政专项/设备智维/HIVE",
	"name":"etl_dwi_eqp_lz_mc_delay_data",
	"owner":"jh_zhaochenlong",
	"templateVersion":"1.0",
	"type":"SparkSQL"
}