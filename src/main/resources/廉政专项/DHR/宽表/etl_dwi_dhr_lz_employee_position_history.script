{
	"configuration":{},
	"connectionName":"MRS_Spark_Agent",
	"content":"-- SPARK sql \n-- ******************************************************************** --\n-- author: jh_caiyi\n-- create time: 2025/05/26 13:04:52 GMT+08:00\n-- descr: 廉政八项-DHR专线-人员任职履历表\n-- ******************************************************************** --\n-- DROP TABLE IF EXISTS dwi_hrm.dwi_dhr_lz_employee_position_history;\n-- CREATE TABLE\n--         dwi_hrm.dwi_dhr_lz_employee_position_history\n--         (\n--                 id STRING COMMENT '主键ID',\n--                 main_industry STRING COMMENT '主业/新产业',\n--                 action_id STRING COMMENT '变动事务',\n--                 action_reason_id STRING COMMENT '变动原因',\n--                 begin_date STRING COMMENT '生效时间',\n--                 end_date STRING COMMENT '失效时间',\n--                 position_type STRING COMMENT '任职类型',\n--                 position_id STRING COMMENT '岗位',\n--                 employee_id STRING COMMENT '员工',\n--                 employee_category_id STRING COMMENT '用工类型',\n--                 position_status_id STRING COMMENT '岗位状态',\n--                 job_step_id STRING COMMENT '职级',\n--                 job_grade_id STRING COMMENT '职等',\n--                 report_position_id STRING COMMENT '汇报职位',\n--                 position_code STRING COMMENT '任职文号',\n--                 end_time_plan STRING COMMENT '计划结束日期',\n--                 position_desc STRING COMMENT '工作说明',\n--                 is_latest STRING COMMENT '是否最新',\n--                 company_id STRING COMMENT '公司ID',\n--                 quit_method_id STRING COMMENT '离职方式',\n--                 operate_time STRING COMMENT '发生时间',\n--                 operator_id STRING COMMENT '操作人',\n--                 create_time STRING COMMENT '创建时间',\n--                 creator_id STRING COMMENT '创建人',\n--                 on_job STRING COMMENT '在职状态;1-在职，0-不在职',\n--                 post_start_date STRING COMMENT '任本岗位开始时间',\n--                 orderno STRING COMMENT '排序码',\n--                 is_virtual STRING COMMENT '是否虚拟',\n--                 job_probation_period_end STRING COMMENT '任职试用期结束日期',\n--                 position_sequence_id STRING COMMENT '序列',\n--                 unit_id STRING COMMENT '单位',\n--                 department_id STRING COMMENT '部门',\n--                 job_title_id STRING COMMENT '职衔',\n--                 post_line STRING COMMENT '所属条线',\n--                 trial_period STRING COMMENT '试岗期月数;3366186-0,3366174-1,3366175-2,3366176-3',\n--                 u_lz_code STRING COMMENT '文号',\n--                 u_job_category_id STRING COMMENT '职类',\n--                 u_job_type_id STRING COMMENT '职种',\n--                 u_working_procedure_id STRING COMMENT '工序',\n--                 u_is_middle_level STRING COMMENT '是否内聘中层;true-是,false-否',\n--                 u_position_desc STRING COMMENT '工作说明2',\n--                 u_familiar_field STRING COMMENT '熟悉领域',\n--                 u_is_marketing_person STRING COMMENT '是否营销人员;true-是,false-否',\n--                 u_middle_senior_ranks STRING COMMENT '差旅标准;3367203-公司主要领导，3367204-公司其他领导，3367205-部门主要负责人，3367206-部门其他负责人，3367271-其他人员'\n--         ) COMMENT '人员任职履历表' STORED AS orc TBLPROPERTIES (\"orc.compress\" = \"SNAPPY\");\nTRUNCATE TABLE dwi_hrm.dwi_dhr_lz_employee_position_history;\nINSERT\n        OVERWRITE TABLE dwi_hrm.dwi_dhr_lz_employee_position_history\nSELECT\n        jobinfomation_history.id ,                          -- 主键ID\n        \"主业\" AS main_industry                     , -- 主业/新产业\n        jobinfomation_history.action_id ,              -- 变动事务\n        jobinfomation_history.action_reason_id ,       -- 变动原因\n        jobinfomation_history.begin_date ,                 -- 生效时间\n        jobinfomation_history.end_date ,                   -- 失效时间\n        jobinfomation_history.end_date ,          -- 任职类型\n        jobinfomation_history.position_id ,            -- 岗位\n        jobinfomation_history.employee_id ,          -- 员工\n        contractdetail_history.work_type ,             -- 用工类型\n        jobinfomation_history.position_status_id ,       -- 岗位状态\n        jobinfomation_history.job_step_id ,            -- 职级      jobinfomation_history.\n        \"\" AS job_grade_id ,                           -- 职等      jobinfomation_history.\n        \"\" AS report_position_id ,                     -- 汇报职位      jobinfomation_history.\n        experience_history.position_code,             -- 任职文号\n        \"\" AS end_time_plan ,                          -- 计划结束日期      jobinfomation_history.\n        \"\" AS position_desc ,                          -- 工作说明      jobinfomation_history.\n        contractdetail_history.is_latest ,             -- 是否最新\n        jobinfomation_history.company_id ,                  -- 公司ID\n        \"\" AS quit_method_id ,                         -- 离职方式      jobinfomation_history.\n        jobinfomation_history.operate_time ,           -- 发生时间\n        jobinfomation_history.operator_id ,                 -- 操作人\n        jobinfomation_history.create_time ,            -- 创建时间\n        jobinfomation_history.creator_id ,                   -- 创建人\n        jobinfomation_history.on_job AS on_job ,                                 -- 在职状态      jobinfomation_history.\n        \"\" AS post_start_date ,                        -- 任本岗位开始时间      jobinfomation_history.\n        time_program_history.u_orderno,               -- 排序码\n        \"\" AS is_virtual ,                             -- 是否虚拟      jobinfomation_history.\n        \"\" AS job_probation_period_en ,                -- 任职试用期结束日期    jobinfomation_history.\n        jobinfomation_history.position_sequence_id ,                    -- 序列\n        jobinfomation_history.unit_id ,                -- 单位\n        time_program_history.depart_id,               -- 部门\n        jobinfomation_history.job_title_id ,           -- 职衔\n        jobinfomation_history.post_line ,              -- 所属条线\n        jobinfomation_history.trial_period AS trial_period ,                           -- 试岗期月数        jobinfomation_history.\n        \"\" AS u_lz_code,                              -- 文号      jobinfomation_history.\n        jobinfomation_history.u_job_category_id ,      -- 职类\n        jobinfomation_history.u_job_type_id ,          -- 职种\n        jobinfomation_history.u_working_procedure_id , -- 工序\n        jobinfomation_history.u_is_middle_level AS u_is_middle_level ,                      -- 是否内聘中层      jobinfomation_history.u_is_middle_level\n        \"\" AS u_position_desc,                        -- 工作说明2     jobinfomation_history.\n        jobinfomation_history.u_familiar_field ,       -- 熟悉领域\n        jobinfomation_history.u_is_marketing_person AS u_is_marketing_person ,                  -- 是否营销人员      jobinfomation_history.\n        jobinfomation_history.u_middle_senior_ranks AS u_middle_senior_ranks                    -- 差旅标准     \nFROM\n        dwi_hrm_jobinfomation jobinfomation_history \n        LEFT JOIN dwi_hrm_u_contractdetail contractdetail_history on contractdetail_history.employee_id=jobinfomation_history.employee_id\n        LEFT JOIN dwi_hrm_outer_experience experience_history on experience_history.employee_id=jobinfomation_history.employee_id\n        LEFT JOIN dwi_hrm_time_program time_program_history on time_program_history.operator_id=jobinfomation_history.operator_id\n-- LIMIT 200\n;\n-- SELECT position_sequence_id,operator_id,employee_id FROM dwi_hrm.dwi_hrm_jobinfomation WHERE position_sequence_id IS NULL OR employee_id IS NULL;\n-- SELECT employee_id FROM dwi_hrm.dwi_hrm_u_contractdetail WHERE employee_id IS NULL ;\n-- SELECT * FROM dwi_hrm.dwi_hrm_outer_experience WHERE employee_id IS NOT NULL ;\n-- SELECT * FROM dwi_hrm.dwi_hrm_time_program WHERE operator_id IS NULL ;\n-- SELECT job_family_id FROM dwi_hrm.dwi_hrm_job WHERE job_family_id IS NULL ;\n\n\n\n\nINSERT OVERWRITE TABLE\n\tdwi_hrm.dwi_dhr_lz_employee_position_history\nSELECT\n\tuser_position.id, -- 主键ID\n\t\"新产业\" AS main_industry, -- 主业/新产业\n\t\"\" AS action_id, -- 变动事务\n\t\"\" AS action_reason_id, -- 变动原因\n\thr_contract_info.begin_date, -- 生效时间\n\thr_contract_info.end_date, -- 失效时间\n\tuser_position.position_type, -- 任职类型\n\tuser_position.position_id, -- 岗位\n\tuser_position.user_no, -- 员工\n\tuser_position.employee_type, -- 用工类型\n\tuser_position.position_type, -- 岗位状态\n\tuser_position.position_class, -- 职级 jobinfomation_history.\n\t\"\" AS job_grade_id, -- 职等 jobinfomation_history.\n\t\"\" AS report_position_id, -- 汇报职位      jobinfomation_history.\n\t\"\" AS position_code, -- 任职文号\n\t\"\" AS end_time_plan, -- 计划结束日期 jobinfomation_history.\n\t\"\" AS position_desc, -- 工作说明      jobinfomation_history.\n\t\"\" AS is_latest, -- 是否最新\n\thr_contract_info.company_id, -- 公司ID\n\t\"\" AS quit_method_id, -- 离职方式      jobinfomation_history.\n\t\"\" AS operate_time, -- 发生时间\n\t\"\" AS operator_id, -- 操作人\n\t\"\" AS create_time, -- 创建时间\n\t\"\" AS creator_id, -- 创建人\n\tuser_base.emp_status AS on_job, -- 在职状态 jobinfomation_history.\n\t\"\" AS post_start_date, -- 任本岗位开始时间      jobinfomation_history.\n\t\"\" AS u_orderno, -- 排序码\n\t\"\" AS is_virtual, -- 是否虚拟 jobinfomation_history.\n\thr_contract_info.probation_period_end_time AS job_probation_period_en, -- 任职试用期结束日期    jobinfomation_history.\n\tuser_position.sequence_id, -- 序列\n\thr_org_position.belong_unit_id, -- 单位\n\t\"\" AS depart_id, -- 部门\n\t\"\" AS job_title_id, -- 职衔\n\t\"\" AS post_line, -- 所属条线\n\thr_contract_info.probation_period AS trial_period, -- 试岗期月数 jobinfomation_history.\n\t\"\" AS u_lz_code, -- 文号      jobinfomation_history.\n\t\"\" AS u_job_category_id, -- 职类\n\t\"\" AS u_job_type_id, -- 职种\n\t\"\" AS u_working_procedure_id, -- 工序\n\t\"\" AS u_is_middle_level, -- 是否内聘中层      jobinfomation_history.u_is_middle_level\n\t\"\" AS u_position_desc, -- 工作说明2     jobinfomation_history.\n\t\"\" AS u_familiar_field, -- 熟悉领域\n\tuser_position.marketing_person AS u_is_marketing_person, -- 是否营销人员      jobinfomation_history.\n\t\"\" AS u_middle_senior_ranks -- 差旅标准\nFROM\n\tdwi_hrm.dwi_hrm_hr_user_position user_position\n\tLEFT JOIN dwi_hrm.dwi_hrm_hr_contract_info hr_contract_info ON hr_contract_info.employee_no = user_position.user_no\n\tLEFT JOIN dwi_hrm.dwi_hrm_hr_user_base user_base ON user_position.user_no = user_base.user_no\n\tLEFT JOIN  dwi_hrm.dwi_hrm_hr_org_position hr_org_position on user_position.position_id=hr_org_position.id\n-- \tLIMIT 200\n;\n-- SELECT position_sequence_id,operator_id,employee_id FROM dwi_hrm.dwi_hrm_jobinfomation WHERE position_sequence_id IS NULL OR employee_id IS NULL;\n-- SELECT employee_id FROM dwi_hrm.dwi_hrm_u_contractdetail WHERE employee_id IS NULL ;\n-- SELECT user_no,position_id FROM dwi_hrm.dwi_hrm_hr_user_position WHERE user_no IS NOT NULL ;\n-- SELECT * FROM dwi_hrm.dwi_hrm_time_program WHERE operator_id IS NULL ;\n-- SELECT * FROM dwi_hrm.dwi_hrm_hr_org_position WHERE job_family_id IS NULL ;\n-- SELECT count(1) FROM dwi_hrm.dwi_dhr_lz_employee_position_history;",
	"currentDatabase":"dwi_hrm",
	"description":"",
	"directory":"/廉政专项/DHR/宽表",
	"name":"etl_dwi_dhr_lz_employee_position_history",
	"templateVersion":"1.0",
	"type":"SparkSQL"
}